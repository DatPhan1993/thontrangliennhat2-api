<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ†Ô∏è Fix Images - Th√¥n Trang Li√™n Nh·∫•t</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        .header h1 {
            color: #667eea;
            margin: 0;
            font-size: 2.5em;
        }
        
        .section {
            background: #f8f9fa;
            margin: 20px 0;
            padding: 25px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            margin: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn.success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }
        
        .btn.danger {
            background: linear-gradient(45deg, #dc3545, #fd7e14);
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
            border-left: 5px solid;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border-color: #28a745;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border-color: #dc3545;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border-color: #ffc107;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #17a2b8;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .step {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.3s ease;
        }
        
        .step:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }
        
        .step h3 {
            color: #667eea;
            margin-top: 0;
        }
        
        .progress {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-bar {
            background: linear-gradient(45deg, #28a745, #20c997);
            height: 100%;
            transition: width 0.5s ease;
            text-align: center;
            color: white;
            line-height: 20px;
            font-weight: bold;
        }
        
        .copy-btn {
            background: #17a2b8;
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 15px;
            margin-left: 10px;
        }
        
        .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ†Ô∏è Fix H√¨nh ·∫¢nh Website</h1>
            <p>C√¥ng c·ª• ch·∫©n ƒëo√°n v√† s·ª≠a l·ªói h√¨nh ·∫£nh kh√¥ng hi·ªÉn th·ªã</p>
        </div>

        <div class="section">
            <h2>üìä Tr·∫°ng th√°i hi·ªán t·∫°i</h2>
            <div id="current-status">
                <div class="status info">üîÑ ƒêang ki·ªÉm tra...</div>
            </div>
            <button class="btn" onclick="checkCurrentStatus()">üîç Ki·ªÉm tra tr·∫°ng th√°i</button>
        </div>

        <div class="section">
            <h2>üéØ S·ª≠a l·ªói t·ª± ƒë·ªông</h2>
            <div class="progress">
                <div class="progress-bar" id="progress" style="width: 0%">0%</div>
            </div>
            <div id="fix-status"></div>
            <button class="btn success" onclick="autoFix()">üöÄ S·ª≠a l·ªói t·ª± ƒë·ªông</button>
            <button class="btn" onclick="testAfterFix()">üß™ Test sau khi s·ª≠a</button>
        </div>

        <div class="section">
            <h2>üìã H∆∞·ªõng d·∫´n th·ªß c√¥ng</h2>
            <p>N·∫øu s·ª≠a l·ªói t·ª± ƒë·ªông kh√¥ng ho·∫°t ƒë·ªông, h√£y l√†m theo c√°c b∆∞·ªõc sau:</p>
            
            <div class="step">
                <h3>B∆∞·ªõc 1: M·ªü trang web ch√≠nh</h3>
                <p>Truy c·∫≠p <span class="highlight">https://thontrangliennhat.com</span></p>
            </div>
            
            <div class="step">
                <h3>B∆∞·ªõc 2: M·ªü Developer Tools</h3>
                <p>Nh·∫•n <span class="highlight">F12</span> ho·∫∑c <span class="highlight">Ctrl+Shift+I</span> (Windows) ho·∫∑c <span class="highlight">Cmd+Option+I</span> (Mac)</p>
            </div>
            
            <div class="step">
                <h3>B∆∞·ªõc 3: Ch·ªçn tab Console</h3>
                <p>Click v√†o tab "Console" trong Developer Tools</p>
            </div>
            
            <div class="step">
                <h3>B∆∞·ªõc 4: Copy & Paste code s·ª≠a l·ªói</h3>
                <div class="code-block" id="fix-code"></div>
                <button class="btn copy-btn" onclick="copyFixCode()">üìã Copy Code</button>
            </div>
            
            <div class="step">
                <h3>B∆∞·ªõc 5: Nh·∫•n Enter</h3>
                <p>Sau khi paste code, nh·∫•n <span class="highlight">Enter</span> ƒë·ªÉ ch·∫°y</p>
            </div>
            
            <div class="step">
                <h3>B∆∞·ªõc 6: Refresh trang</h3>
                <p>Nh·∫•n <span class="highlight">F5</span> ho·∫∑c <span class="highlight">Ctrl+R</span> ƒë·ªÉ t·∫£i l·∫°i trang</p>
            </div>
        </div>

        <div class="section">
            <h2>üî¨ Test h√¨nh ·∫£nh</h2>
            <div id="image-test-results"></div>
            <button class="btn" onclick="testImages()">üñºÔ∏è Test h√¨nh ·∫£nh</button>
            <button class="btn danger" onclick="clearCache()">üóëÔ∏è X√≥a cache</button>
        </div>

        <div class="section">
            <h2>üìû Li√™n h·ªá h·ªó tr·ª£</h2>
            <div class="status info">
                <strong>üì± Hotline:</strong> 0943 768 858<br>
                <strong>üåê Website:</strong> thontrangliennhat.com<br>
                <strong>üîß API:</strong> api.thontrangliennhat.com
            </div>
        </div>
    </div>

    <script>
        let progress = 0;

        function updateProgress(percent) {
            progress = percent;
            const progressBar = document.getElementById('progress');
            progressBar.style.width = percent + '%';
            progressBar.textContent = percent + '%';
        }

        function addStatus(containerId, message, type = 'info', append = false) {
            const container = document.getElementById(containerId);
            const statusDiv = `<div class="status ${type}">${message}</div>`;
            
            if (append) {
                container.innerHTML += statusDiv;
            } else {
                container.innerHTML = statusDiv;
            }
        }

        function checkCurrentStatus() {
            addStatus('current-status', 'üîÑ ƒêang ki·ªÉm tra k·∫øt n·ªëi API...', 'info');
            
            // Check API connection
            fetch('https://api.thontrangliennhat.com/api/health')
                .then(response => response.json())
                .then(data => {
                    addStatus('current-status', '‚úÖ API ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng', 'success');
                    
                    // Check if we're on the main site
                    if (window.location.hostname === 'thontrangliennhat.com') {
                        checkMainSiteImages();
                    } else {
                        addStatus('current-status', '‚ö†Ô∏è B·∫°n ƒëang ·ªü trang debug. H√£y m·ªü thontrangliennhat.com ƒë·ªÉ ki·ªÉm tra', 'warning', true);
                    }
                })
                .catch(error => {
                    addStatus('current-status', '‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi API: ' + error.message, 'error');
                });
        }

        function checkMainSiteImages() {
            // Check if we can find images with localhost URLs
            const images = document.querySelectorAll('img');
            let localhostCount = 0;
            
            images.forEach(img => {
                if (img.src.includes('localhost:3001')) {
                    localhostCount++;
                }
            });
            
            if (localhostCount > 0) {
                addStatus('current-status', `‚ùå T√¨m th·∫•y ${localhostCount} h√¨nh ·∫£nh v·ªõi URL localhost`, 'error', true);
                addStatus('current-status', 'üí° C·∫ßn s·ª≠a l·ªói URL h√¨nh ·∫£nh', 'warning', true);
            } else {
                addStatus('current-status', '‚úÖ Kh√¥ng t√¨m th·∫•y URL localhost trong h√¨nh ·∫£nh', 'success', true);
            }
        }

        async function autoFix() {
            updateProgress(0);
            addStatus('fix-status', 'üöÄ B·∫Øt ƒë·∫ßu s·ª≠a l·ªói t·ª± ƒë·ªông...', 'info');
            
            // Step 1: Check API
            updateProgress(20);
            try {
                const response = await fetch('https://api.thontrangliennhat.com/api/health');
                if (!response.ok) throw new Error('API not responding');
                addStatus('fix-status', '‚úÖ B∆∞·ªõc 1: API ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng', 'success', true);
            } catch (error) {
                addStatus('fix-status', '‚ùå B∆∞·ªõc 1: L·ªói API - ' + error.message, 'error', true);
                return;
            }

            // Step 2: Fix existing images
            updateProgress(40);
            const images = document.querySelectorAll('img');
            let fixedCount = 0;
            
            images.forEach(img => {
                if (img.src.includes('localhost:3001')) {
                    const oldSrc = img.src;
                    img.src = img.src.replace('http://localhost:3001', 'https://api.thontrangliennhat.com');
                    fixedCount++;
                    console.log('üîß Fixed image:', oldSrc, '->', img.src);
                }
            });
            
            addStatus('fix-status', `‚úÖ B∆∞·ªõc 2: ƒê√£ s·ª≠a ${fixedCount} h√¨nh ·∫£nh`, 'success', true);

            // Step 3: Install fetch interceptor
            updateProgress(60);
            const originalFetch = window.fetch;
            window.fetch = function(input, init) {
                if (typeof input === 'string' && input.includes('localhost:3001')) {
                    input = input.replace('http://localhost:3001', 'https://api.thontrangliennhat.com');
                    console.log('‚úÖ Fixed fetch URL:', input);
                }
                return originalFetch.call(this, input, init);
            };
            
            addStatus('fix-status', '‚úÖ B∆∞·ªõc 3: ƒê√£ c√†i ƒë·∫∑t b·ªô ch·∫∑n fetch', 'success', true);

            // Step 4: Override Image constructor
            updateProgress(80);
            const OriginalImage = window.Image;
            window.Image = function() {
                const img = new OriginalImage();
                const originalSrcSetter = Object.getOwnPropertyDescriptor(HTMLImageElement.prototype, 'src').set;
                
                Object.defineProperty(img, 'src', {
                    set: function(value) {
                        if (typeof value === 'string' && value.includes('localhost:3001')) {
                            value = value.replace('http://localhost:3001', 'https://api.thontrangliennhat.com');
                            console.log('‚úÖ Fixed new image URL:', value);
                        }
                        originalSrcSetter.call(this, value);
                    },
                    get: function() {
                        return this.getAttribute('src');
                    }
                });
                
                return img;
            };
            
            addStatus('fix-status', '‚úÖ B∆∞·ªõc 4: ƒê√£ ghi ƒë√® Image constructor', 'success', true);

            // Step 5: Complete
            updateProgress(100);
            addStatus('fix-status', 'üéâ Ho√†n th√†nh! H√¨nh ·∫£nh s·∫Ω hi·ªÉn th·ªã b√¨nh th∆∞·ªùng', 'success', true);
            addStatus('fix-status', 'üí° N·∫øu h√¨nh ·∫£nh v·∫´n kh√¥ng hi·ªÉn th·ªã, h√£y refresh trang (F5)', 'info', true);
        }

        async function testImages() {
            addStatus('image-test-results', 'üîÑ ƒêang test h√¨nh ·∫£nh...', 'info');
            
            try {
                const response = await fetch('https://api.thontrangliennhat.com/api/products');
                const data = await response.json();
                const products = data.data || [];
                
                if (products.length === 0) {
                    addStatus('image-test-results', '‚ùå Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o', 'error');
                    return;
                }
                
                const testProduct = products[0];
                const imageUrl = testProduct.images && testProduct.images[0];
                
                if (!imageUrl) {
                    addStatus('image-test-results', '‚ùå S·∫£n ph·∫©m kh√¥ng c√≥ h√¨nh ·∫£nh', 'error');
                    return;
                }
                
                // Create proper image URL
                const fullImageUrl = imageUrl.startsWith('/') 
                    ? `https://api.thontrangliennhat.com${imageUrl}`
                    : imageUrl;
                
                // Test image loading
                const testImg = new Image();
                
                testImg.onload = function() {
                    addStatus('image-test-results', '‚úÖ Test th√†nh c√¥ng! H√¨nh ·∫£nh c√≥ th·ªÉ t·∫£i ƒë∆∞·ª£c', 'success');
                    addStatus('image-test-results', `üì∑ URL test: ${fullImageUrl}`, 'info', true);
                    
                    // Display test image
                    const imgDisplay = `
                        <div style="margin-top: 20px; text-align: center;">
                            <img src="${fullImageUrl}" alt="Test Image" style="max-width: 300px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                            <p><strong>S·∫£n ph·∫©m:</strong> ${testProduct.name}</p>
                        </div>
                    `;
                    addStatus('image-test-results', imgDisplay, 'success', true);
                };
                
                testImg.onerror = function() {
                    addStatus('image-test-results', '‚ùå Test th·∫•t b·∫°i! Kh√¥ng th·ªÉ t·∫£i h√¨nh ·∫£nh', 'error');
                    addStatus('image-test-results', `üîó URL l·ªói: ${fullImageUrl}`, 'error', true);
                };
                
                testImg.src = fullImageUrl;
                
            } catch (error) {
                addStatus('image-test-results', '‚ùå L·ªói khi test: ' + error.message, 'error');
            }
        }

        function testAfterFix() {
            addStatus('fix-status', 'üß™ ƒêang test sau khi s·ª≠a...', 'info', true);
            
            setTimeout(() => {
                testImages();
                
                // Check for remaining localhost URLs
                const images = document.querySelectorAll('img');
                let localhostCount = 0;
                
                images.forEach(img => {
                    if (img.src.includes('localhost:3001')) {
                        localhostCount++;
                    }
                });
                
                if (localhostCount === 0) {
                    addStatus('fix-status', '‚úÖ T·∫•t c·∫£ URL localhost ƒë√£ ƒë∆∞·ª£c s·ª≠a', 'success', true);
                } else {
                    addStatus('fix-status', `‚ö†Ô∏è V·∫´n c√≤n ${localhostCount} URL localhost`, 'warning', true);
                }
            }, 1000);
        }

        function clearCache() {
            addStatus('image-test-results', 'üóëÔ∏è ƒêang x√≥a cache...', 'info');
            
            // Clear various caches
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    return Promise.all(
                        cacheNames.map(cacheName => caches.delete(cacheName))
                    );
                }).then(() => {
                    addStatus('image-test-results', '‚úÖ ƒê√£ x√≥a service worker cache', 'success', true);
                });
            }
            
            // Clear localStorage and sessionStorage
            try {
                localStorage.clear();
                sessionStorage.clear();
                addStatus('image-test-results', '‚úÖ ƒê√£ x√≥a local storage', 'success', true);
            } catch (e) {
                addStatus('image-test-results', '‚ö†Ô∏è Kh√¥ng th·ªÉ x√≥a local storage', 'warning', true);
            }
            
            addStatus('image-test-results', 'üí° H√£y refresh trang (F5) ƒë·ªÉ ho√†n t·∫•t', 'info', true);
        }

        function generateFixCode() {
            return `
// üõ†Ô∏è Fix h√¨nh ·∫£nh - Th√¥n Trang Li√™n Nh·∫•t
console.log('üöÄ B·∫Øt ƒë·∫ßu s·ª≠a l·ªói h√¨nh ·∫£nh...');

// S·ª≠a t·∫•t c·∫£ h√¨nh ·∫£nh hi·ªán c√≥
document.querySelectorAll('img').forEach(img => {
    if (img.src.includes('localhost:3001')) {
        const oldSrc = img.src;
        img.src = img.src.replace('http://localhost:3001', 'https://api.thontrangliennhat.com');
        console.log('‚úÖ ƒê√£ s·ª≠a:', oldSrc, '->', img.src);
    }
});

// Ch·∫∑n fetch requests
const originalFetch = window.fetch;
window.fetch = function(input, init) {
    if (typeof input === 'string' && input.includes('localhost:3001')) {
        input = input.replace('http://localhost:3001', 'https://api.thontrangliennhat.com');
        console.log('‚úÖ ƒê√£ s·ª≠a fetch URL:', input);
    }
    return originalFetch.call(this, input, init);
};

// Ghi ƒë√® Image constructor
const OriginalImage = window.Image;
window.Image = function() {
    const img = new OriginalImage();
    const originalSrcSetter = Object.getOwnPropertyDescriptor(HTMLImageElement.prototype, 'src').set;
    
    Object.defineProperty(img, 'src', {
        set: function(value) {
            if (typeof value === 'string' && value.includes('localhost:3001')) {
                value = value.replace('http://localhost:3001', 'https://api.thontrangliennhat.com');
                console.log('‚úÖ ƒê√£ s·ª≠a URL h√¨nh ·∫£nh m·ªõi:', value);
            }
            originalSrcSetter.call(this, value);
        },
        get: function() {
            return this.getAttribute('src');
        }
    });
    
    return img;
};

console.log('‚úÖ Ho√†n th√†nh s·ª≠a l·ªói! Refresh trang ƒë·ªÉ th·∫•y hi·ªáu qu·∫£.');
            `.trim();
        }

        function copyFixCode() {
            const code = generateFixCode();
            navigator.clipboard.writeText(code).then(() => {
                alert('‚úÖ ƒê√£ copy code! H√£y paste v√†o Console c·ªßa trang ch√≠nh');
            }).catch(() => {
                alert('‚ùå Kh√¥ng th·ªÉ copy. H√£y ch·ªçn v√† copy th·ªß c√¥ng');
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('fix-code').textContent = generateFixCode();
            
            // Auto check status
            setTimeout(checkCurrentStatus, 1000);
        });
    </script>
</body>
</html> 